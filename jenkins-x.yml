buildPack: gradle
pipelineConfig:
  extends:
    file: ./jenkins-x-sonar.yml
  agent:
    image: gradle5-java11
  pipelines:
    release:
      postBuild:
        steps:
          - name: sonar-analysis
            image: sonarsource/sonar-scanner-cli:4.4
            command: sonar-scanner
            args:
              - "-Dsonar.host.url=${SONAR_HOST}"
              - "-Dsonar.login=${SONAR_TOKEN}"
              - "-Dsonar.projectKey=${REPO_OWNER}:${REPO_NAME}"
              - "-Dsonar.organization=${SONAR_ORG}"
              - "-Dsonar.projectName=${REPO_NAME}"
              - "-Dsonar.scm.provider=${SONAR_SCM}"
            env:
              - name: SONAR_TOKEN
                valueFrom:
                  secretKeyRef:
                    name: sonar
                    key: sonar.login
              - name: SONAR_ORG
                valueFrom:
                  secretKeyRef:
                    name: sonar
                    key: sonar.organization
              - name: SONAR_HOST
                valueFrom:
                  secretKeyRef:
                    name: sonar
                    key: sonar.host.url
              - name: SONAR_SCM
                valueFrom:
                  secretKeyRef:
                    name: sonar
                    key: sonar.scm.provider
